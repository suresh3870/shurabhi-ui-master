----CREATE DATABASE "shurabhi200" and run below queries to create other tables


create table audit_log (
       id integer generated by default as identity,
        create_date timestamp,
        discription varchar(255),
        user_created varchar(255),
        primary key (id)
    );
create table bill (
       billid integer not null,
        bill_amount double precision not null,
        bill_date timestamp,
        paid_by varchar(255),
        order_id integer not null,
        primary key (billid)
    );
create table book_seat (
       seat_id integer not null,
        booking_date timestamp,
        primary key (seat_id)
    );
create table feed_back (
       feed_back_id integer not null,
        feed_back_date timestamp,
        feedback varchar(255),
        feedback1to5 integer not null,
        ordersid integer not null,
        primary key (feed_back_id)
    );
create table menu (
       menu_id integer not null,
        item varchar(255),
        price integer,
        primary key (menu_id)
    );
create table order_details (
       order_detailsid integer not null,
        quantity integer,
        item_totalprice double precision not null,
        menu_id integer not null,
        order_id integer not null,
        primary key (order_detailsid)
    );
create table orders (
       order_id integer not null,
        order_date timestamp,
        username varchar(50) not null,
        city VARCHAR(50),
        primary key (order_id)
    );
create table users (
       username varchar(50) not null,
        authority varchar(255),
        enabled boolean not null,
        password varchar(255),
        primary key (username)
    );
alter table bill
       add constraint FKk4iu99d2pp9qbgqq35u6kpyif
       foreign key (order_id)
       references orders;
alter table order_details
       add constraint FKb9k7qt78t717b820rr01jsea1
       foreign key (menu_id)
       references menu;
alter table order_details
       add constraint FKjyu2qbqt8gnvno9oe9j2s2ldk
       foreign key (order_id)
       references orders;
alter table orders
       add constraint FK5ul5qtyh6slfyq8i4jby7qecx
       foreign key (username)
       references users;



create table users_tb (id  bigserial not null, email varchar(50), password varchar(120), username varchar(20), primary key (id));
create table roles (id  serial not null, name varchar(20), primary key (id));
create table user_roles (user_id int8 not null REFERENCES users_tb (id), role_id int4 not null REFERENCES roles (id), primary key (user_id, role_id));


INSERT INTO MENU  VALUES (1, 'Dosa', 35);
INSERT INTO MENU VALUES (2, 'Rice', 45);
INSERT INTO MENU VALUES (3, 'Roti', 30);
INSERT INTO MENU VALUES (4, 'Jira Rice', 60);
INSERT INTO MENU VALUES (5, 'Dal', 90);
INSERT INTO users_tb VALUES (1, 'suresh.kumar@gmail.com','$2a$10$KzQAQ4kAjSBsd.0MiHgyAecxwhj8MZrqju3FcjGrVn0TxWz563Qta','suresh');
INSERT INTO users_tb VALUES (2, 'ram@gmail.com','$2a$10$CEowIBoP73DKZf./TVVLqO.Z2034Rk717xxfecnvxyt8HHVFLLe0a','ram');
INSERT INTO users_tb VALUES (3, 'mohan@gmail.com','$2a$10$2mT8yco7eGGm/dtUsQffLOXME5aq5sYR9JJpG6xTOtuXGePIBPhUS','mohan');
INSERT INTO USERS VALUES ('ram', 'USER', TRUE, '$2a$10$CEowIBoP73DKZf./TVVLqO.Z2034Rk717xxfecnvxyt8HHVFLLe0a');
INSERT INTO USERS VALUES ('suresh', 'ADMIN', TRUE, '$2a$10$KzQAQ4kAjSBsd.0MiHgyAecxwhj8MZrqju3FcjGrVn0TxWz563Qta');
INSERT INTO USERS VALUES ('mohan', 'ADMIN', TRUE, '$2a$10$2mT8yco7eGGm/dtUsQffLOXME5aq5sYR9JJpG6xTOtuXGePIBPhUS');
INSERT INTO roles VALUES(1, 'ROLE_ADMIN');
INSERT INTO roles VALUES(2, 'ROLE_USER');
insert into user_roles values(1,1);
insert into user_roles values(2,2);
insert into user_roles values(3,2);
insert into orders values (1,'2020-11-23 23:12:02.991','suresh','Chennai');
insert into orders values (2,'2020-10-02 23:12:02.991','ram','Bangalore');
insert into orders values (3,'2021-02-05 23:12:02.991','ram','Mumbai');
insert into orders values (4,'2021-11-23 23:12:02.991','mohan','Jaipur');

insert into order_details values (1,2,50,1,1);
insert into order_details values (2,5,100,5,2);
insert into order_details values (3,8,150,3,3);
insert into order_details values (4,3,500,2,4);

insert into bill values (1,'500','2020-11-23 23:12:02.991','CASH',1);
insert into bill values (2,'1001','2020-10-02 23:12:02.991','CARD',2);
insert into bill values (3,'2500','2021-02-05 23:12:02.991','CASH',3);
insert into bill values (4,'3000','2021-11-23 23:12:02.991','CARD',4);

CREATE INDEX idx_bill_timestamp on bill(bill_date);

create OR replace view All_orders AS
(select b.order_id,a.order_date, a.username,b.quantity,b.item_totalprice/b.quantity as "unit_price",
 b.item_totalprice,b.menu_id from orders a , order_details b where a.order_id=b.order_id);

create OR replace view Max_sale_Day AS
( select max(bill_amount), extract(DAY from bill_date), to_char(bill_date, 'MONTH')
 from bill
 group by extract(DAY from bill_date), to_char(bill_date, 'MONTH'));

create OR replace view Max_sale_Month AS
 ( select max(bill_amount), extract(YEAR from bill_date), to_char(bill_date, 'MONTH')
  from bill
  group by extract(YEAR from bill_date), to_char(bill_date, 'MONTH'));

create OR replace view sale_by_City AS(
  select sum(b.bill_amount),extract(YEAR from bill_date), to_char(bill_date, 'MONTH'),a.city
  from orders a , bill b
  where a.order_id= b.order_id
  group by extract(YEAR from bill_date), to_char(bill_date, 'MONTH'), a.city);
